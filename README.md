# Reverse Proxy & Monitor

–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞–º–∏ —Å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –Ω–∞ –±–∞–∑–µ FastAPI.

## üöÄ –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Ubuntu 22.04

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–ª–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
wget https://raw.githubusercontent.com/globalduckmac/ProxySense/main/deploy_fixed.sh
chmod +x deploy_fixed.sh
sudo ./deploy_fixed.sh
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏
wget https://raw.githubusercontent.com/globalduckmac/ProxySense/main/deploy_simple.sh
chmod +x deploy_simple.sh
sudo ./deploy_simple.sh
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ production
```bash
# –ï—Å–ª–∏ —É –≤–∞—Å –æ—à–∏–±–∫–∏ Pydantic –∏–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
cd /opt/reverse-proxy-monitor
wget https://raw.githubusercontent.com/globalduckmac/ProxySense/main/fix_production_errors.sh
chmod +x fix_production_errors.sh
sudo ./fix_production_errors.sh
```

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ Ubuntu 22.04+ –∏ –≤–∫–ª—é—á–∞—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–µ—Ä–æ–≤** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —á–µ—Ä–µ–∑ Glances API
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞–º–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ NS –∑–∞–ø–∏—Å–µ–π
- **SSH —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ SSH
- **Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤ —Å SSL
- **Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –∞–ª–µ—Ä—Ç—ã –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- **–í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** - —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

## üîß –ü–µ—Ä–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É**:
   - URL: `http://your-domain.com` –∏–ª–∏ `http://your-ip:5000`
   - –õ–æ–≥–∏–Ω: `admin`
   - –ü–∞—Ä–æ–ª—å: `admin123`

2. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å** –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegram** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```bash
   nano /opt/reverse-proxy-monitor/.env
   # –î–æ–±–∞–≤–∏—Ç—å:
   # TELEGRAM_BOT_TOKEN=your_bot_token
   # TELEGRAM_CHAT_ID=your_chat_id
   ```

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL** (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –¥–æ–º–µ–Ω):
   ```bash
   apt install certbot python3-certbot-nginx
   certbot --nginx -d your-domain.com
   ```

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞
```bash
systemctl status reverse-proxy-monitor
```

### –õ–æ–≥–∏
```bash
journalctl -u reverse-proxy-monitor -f
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
systemctl restart reverse-proxy-monitor
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
su -c '/opt/reverse-proxy-monitor/update.sh' rpmonitor
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Backend**: FastAPI + SQLAlchemy + PostgreSQL
- **Frontend**: Jinja2 templates + Vanilla JavaScript
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: APScheduler + Glances API
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: JWT + bcrypt + —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ**: Systemd + Nginx + UFW

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `/opt/reverse-proxy-monitor/.env`:

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://user:pass@localhost/db

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
SECRET_KEY=your_secret_key
JWT_SECRET_KEY=your_jwt_secret

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
HOST=0.0.0.0
PORT=5000

# Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_BOT_TOKEN=your_token
TELEGRAM_CHAT_ID=your_chat_id
```

## üîç –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è

#### 1. –û—à–∏–±–∫–∏ Pydantic validation
**–û—à–∏–±–∫–∞**: `Extra inputs are not permitted` –¥–ª—è JWT_SECRET_KEY, ENCRYPTION_KEY
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `fix_production_errors.sh`

#### 2. –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ database.py  
**–û—à–∏–±–∫–∞**: `SyntaxError: invalid syntax` –≤ backend/database.py
**–†–µ—à–µ–Ω–∏–µ**: –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—É–ª–∞ –ë–î

#### 3. –í—Å–µ —Ä–æ—É—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç 404
**–û—à–∏–±–∫–∞**: 404 Not Found –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–æ—É—Ç–µ—Ä–æ–≤ –≤ main.py

#### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π  
**–û—à–∏–±–∫–∞**: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Ö–æ–¥ –∑–∞ reverse proxy
**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ cookie –Ω–∞ `secure=False`

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

#### –°–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
journalctl -u reverse-proxy-monitor --no-pager -n 20
systemctl status reverse-proxy-monitor
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
```bash
ss -tlnp | grep :5000
ufw status
curl -I http://localhost:5000/
```

#### –¢–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
cd /opt/reverse-proxy-monitor
source venv/bin/activate
python3 -c "from backend.database import engine; print('DB OK' if engine else 'DB Error')"
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–∞–π–ª–µ [install.md](install.md).

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π:
- –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
- –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–¥ –∏–∑ Git
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `rpmonitor`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω UFW —Ñ–∞–π—Ä–≤–æ–ª
- –ü–∞—Ä–æ–ª–∏ —Ö—ç—à–∏—Ä—É—é—Ç—Å—è bcrypt
- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (admin/user)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `.env`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

**–í–∞–∂–Ω–æ**: –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞!